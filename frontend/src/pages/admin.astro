---
import axios from "axios";
import "../styles/global.css";

let feedbackList = [];
let errorMessage = "";

try {
  const res = await axios.get("http://localhost:4000/api/feedback");
  feedbackList = res.data;
} catch (e) {
  console.error("Error fetching feedback:", e);
  errorMessage = "Error loading feedback. Please ensure the backend server is running.";
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin Panel - Feedback Management</title>
    <meta name="description" content="Manage anonymous feedback" />
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css"
      rel="stylesheet"
    >
  </head>

  <body class="min-h-screen bg-gradient-to-br from-black via-neutral-900 to-gray-900 text-white">
    <div class="max-w-6xl mx-auto px-4 py-10">
      <!-- Header -->
      <header class="mb-10">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold text-white">Feedback Dashboard</h1>
            <p class="text-gray-400 mt-1">Manage and review anonymous feedback submissions</p>
          </div>
          <div class="flex items-center space-x-2">
            <div class="w-3 h-3 rounded-full bg-green-400"></div>
            <span class="text-sm text-gray-400">System Online</span>
          </div>
        </div>
      </header>

      <!-- Feedback Section -->
      <div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl overflow-hidden">
        <div class="px-6 py-5 border-b border-white/10 bg-white/5 flex justify-between items-center">
          <h2 class="text-lg font-semibold text-white">Feedback Submissions</h2>
          <div class="text-sm text-gray-400">
            {feedbackList.length} {feedbackList.length === 1 ? 'entry' : 'entries'}
          </div>
        </div>

        {errorMessage ? (
          <!-- Error Message -->
          <div class="p-8 text-center">
            <div class="bg-red-900/30 border border-red-600/30 rounded-xl p-6">
              <div class="mx-auto bg-red-600/20 w-12 h-12 rounded-full flex items-center justify-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
              </div>
              <h3 class="text-lg font-medium text-white mb-2">Connection Error</h3>
              <p class="text-gray-400 mb-4">{errorMessage}</p>
              <a href="/" class="inline-flex items-center px-4 py-2 rounded-md text-black font-medium bg-white hover:bg-gray-200 transition-all duration-200">
                Go to Feedback Form
              </a>
            </div>
          </div>
        ) : feedbackList.length === 0 ? (
          <!-- No Feedback -->
          <div class="py-16 text-center">
            <div class="mx-auto w-24 h-24 rounded-full bg-white/10 flex items-center justify-center mb-6">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
            </div>
            <h3 class="text-lg font-medium text-white mb-1">No feedback yet</h3>
            <p class="text-gray-400 max-w-md mx-auto">
              When feedback is submitted, it will appear here.
            </p>
            <div class="mt-6">
              <a href="/" class="inline-flex items-center px-4 py-2 rounded-md text-black font-medium bg-white hover:bg-gray-200 transition-all duration-200">
                Go to Feedback Form
              </a>
            </div>
          </div>
        ) : (
          <!-- Feedback Entries -->
          <div class="divide-y divide-white/10">
            {feedbackList.map((f:any) => (
              <div class="p-6 hover:bg-white/10 transition-colors duration-200">
                <div class="flex">
                  <div class="flex-shrink-0 mr-4">
                    <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
                      <span class="text-white font-medium">
                        {f.category ? f.category.charAt(0).toUpperCase() : '#'}
                      </span>
                    </div>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center justify-between">
                      <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-white/10 text-white">
                        {f.category || 'Uncategorized'}
                      </span>
                      <span class="text-sm text-gray-400">
                        {new Date(f.created_at).toLocaleString()}
                      </span>
                    </div>
                    <p class="mt-3 text-gray-200">{f.message}</p>
                    <div class="mt-4 flex items-center">
                      <button class="text-sm text-gray-300 hover:text-white font-medium flex items-center transition-all duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
                        </svg>
                        Reply
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>

      <!-- Footer -->
      <footer class="mt-10 text-center text-gray-500 text-sm">
        <p>ðŸ–¤ Secure Feedback Management System</p>
      </footer>
    </div>
  </body>
</html>
