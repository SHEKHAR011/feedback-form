---
import Layout from "../layouts/Layout.astro";
import { SignedIn, SignedOut } from '@clerk/astro/components';

const auth = Astro.locals.auth();
const userId = auth.userId;
---

<Layout title="Get Your User ID">
  <div class="min-h-screen flex items-center justify-center p-6">
    <div class="max-w-2xl w-full">
      <SignedOut>
        <div class="relative backdrop-blur-xl bg-white/5 border border-white/20 rounded-3xl shadow-2xl p-8 text-center">
          <h1 class="text-3xl font-bold text-white mb-4">Sign In Required</h1>
          <p class="text-gray-400 mb-6">Please sign in to view your Clerk User ID</p>
        </div>
      </SignedOut>

      <SignedIn>
        <div class="relative backdrop-blur-xl bg-white/5 border border-white/20 rounded-3xl shadow-2xl p-8">
          <h1 class="text-3xl font-bold text-white mb-6">Your Clerk User ID</h1>
          
          <div class="bg-black/30 border border-white/20 rounded-xl p-6 mb-6">
            <label class="block text-sm font-semibold text-gray-300 mb-2">User ID</label>
            <div class="flex items-center gap-3">
              <code id="userId" class="flex-1 text-green-400 font-mono text-lg break-all">
                {userId}
              </code>
              <button 
                onclick="copyUserId()"
                class="px-4 py-2 font-semibold rounded-lg text-black bg-white hover:bg-gray-200 transition-all duration-300 whitespace-nowrap"
              >
                Copy
              </button>
            </div>
            <p id="copyStatus" class="text-sm text-gray-400 mt-2 min-h-[1.25rem]"></p>
          </div>

          <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-6 mb-6">
            <h2 class="text-xl font-bold text-white mb-3 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              How to Set Up Admin Access
            </h2>
            <ol class="space-y-3 text-gray-300">
              <li class="flex">
                <span class="font-bold text-blue-400 mr-3">1.</span>
                <span>Copy your User ID above</span>
              </li>
              <li class="flex">
                <span class="font-bold text-blue-400 mr-3">2.</span>
                <span>Open <code class="bg-black/30 px-2 py-1 rounded text-sm">/frontend/.env</code> file</span>
              </li>
              <li class="flex">
                <span class="font-bold text-blue-400 mr-3">3.</span>
                <span>Add your User ID to the <code class="bg-black/30 px-2 py-1 rounded text-sm">ADMIN_USER_IDS</code> variable</span>
              </li>
              <li class="flex">
                <span class="font-bold text-blue-400 mr-3">4.</span>
                <span>For multiple admins, separate IDs with commas</span>
              </li>
              <li class="flex">
                <span class="font-bold text-blue-400 mr-3">5.</span>
                <span>Restart your dev server</span>
              </li>
            </ol>
          </div>

          <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4">
            <h3 class="text-lg font-bold text-yellow-400 mb-2">Example .env Configuration:</h3>
            <pre class="bg-black/50 p-4 rounded-lg overflow-x-auto text-sm"><code class="text-gray-300">ADMIN_USER_IDS={userId}</code></pre>
          </div>

          <div class="mt-6 flex gap-4">
            <a 
              href="/admin" 
              class="flex-1 text-center px-6 py-3 font-semibold rounded-xl text-black bg-white hover:bg-gray-200 transition-all duration-300"
            >
              Go to Admin Dashboard
            </a>
            <a 
              href="/" 
              class="flex-1 text-center px-6 py-3 font-semibold rounded-xl text-white bg-white/10 hover:bg-white/20 border border-white/20 transition-all duration-300"
            >
              Back to Home
            </a>
          </div>
        </div>
      </SignedIn>
    </div>
  </div>

  <script>
    function copyUserId() {
      const userId = document.getElementById('userId')?.textContent;
      const status = document.getElementById('copyStatus');
      
      if (userId && status) {
        navigator.clipboard.writeText(userId.trim()).then(() => {
          status.textContent = '✅ Copied to clipboard!';
          status.className = 'text-sm text-green-400 mt-2 min-h-[1.25rem]';
          setTimeout(() => {
            status.textContent = '';
          }, 3000);
        }).catch(() => {
          status.textContent = '❌ Failed to copy';
          status.className = 'text-sm text-red-400 mt-2 min-h-[1.25rem]';
        });
      }
    }

    // Make function globally available
    (window as any).copyUserId = copyUserId;
  </script>
</Layout>
